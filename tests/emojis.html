<html>
<body>
<script>
function wrapEmojis(text) {
    let flagCounter = 0;
    let flags = [];
    
    // First handle flag emoji sequences
    text = text.replace(/(\uD83C[\uDDE6-\uDDFF]){2}/g, (match) => {
        flags.push(match);
        return `###FLAG${flagCounter++}###`;
    });
    
    // Regex for detecting emoji sequences
    // This pattern includes emoji with variation selectors (FE0F) and keycap sequences
    const emojiPattern = new RegExp(
        // Keycap sequences (digit/symbol + FE0F + 20E3)
        '(?:[0-9#*]\\uFE0F?\\u20E3)|' +
        
        // Basic emoji
        '(?:[\\u2011-\\u26FF]|[\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD10-\\uDDFF])' +
        // Optional variation selector
        '(?:\\uFE0F)?' +
        // Optional skin tone modifier
        '(?:\\uD83C[\\uDFFB-\\uDFFF])?' +
        // Optional zero width joiner sequences (for compound emoji)
        '(?:\\u200D(?:[\\u2011-\\u26FF]|[\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD10-\\uDDFF])' +
        '(?:\\uFE0F)?' +
        '(?:\\uD83C[\\uDFFB-\\uDFFF])?)*',
        'g'
    );
    
    // Replace all emoji with spans
    text = text.replace(emojiPattern, "<span class='emoji'>$&</span>");
    
    // Replace flag placeholders
    flags.forEach((flag, index) => {
        text = text.replace(
            `###FLAG${index}###`,
            `<span class='emoji'>${flag}</span>`
        );
    });
    
    return text;
}

// Unit test function
function testEmojiWrapping() {
  const testCases = [
    // Basic emoji
    { input: "Hello ğŸ˜€ World", expected: "Hello <span class='emoji'>ğŸ˜€</span> World" },
    
    // Flag emoji
    { input: "Countries: ğŸ‡ºğŸ‡¸ ğŸ‡¯ğŸ‡µ ğŸ‡ªğŸ‡¸", expected: "Countries: <span class='emoji'>ğŸ‡ºğŸ‡¸</span> <span class='emoji'>ğŸ‡¯ğŸ‡µ</span> <span class='emoji'>ğŸ‡ªğŸ‡¸</span>" },
    
    // Skin tone modifiers
    { input: "Hands: ğŸ‘ ğŸ‘ğŸ» ğŸ‘ğŸ¼ ğŸ‘ğŸ½ ğŸ‘ğŸ¾ ğŸ‘ğŸ¿", expected: "Hands: <span class='emoji'>ğŸ‘</span> <span class='emoji'>ğŸ‘ğŸ»</span> <span class='emoji'>ğŸ‘ğŸ¼</span> <span class='emoji'>ğŸ‘ğŸ½</span> <span class='emoji'>ğŸ‘ğŸ¾</span> <span class='emoji'>ğŸ‘ğŸ¿</span>" },
    
    // ZWJ sequences (family)
    { input: "Family: ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", expected: "Family: <span class='emoji'>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>" },
    
    // ZWJ sequences (professions)
    { input: "Jobs: ğŸ‘¨â€ğŸ’» ğŸ‘©â€ğŸ”¬ ğŸ‘¨â€ğŸš’", expected: "Jobs: <span class='emoji'>ğŸ‘¨â€ğŸ’»</span> <span class='emoji'>ğŸ‘©â€ğŸ”¬</span> <span class='emoji'>ğŸ‘¨â€ğŸš’</span>" },
    
    // ZWJ with skin tones
    { input: "Diverse: ğŸ‘¨ğŸ½â€ğŸ’» ğŸ‘©ğŸ¿â€ğŸ”¬", expected: "Diverse: <span class='emoji'>ğŸ‘¨ğŸ½â€ğŸ’»</span> <span class='emoji'>ğŸ‘©ğŸ¿â€ğŸ”¬</span>" },
    
    // Variation selectors
    { input: "Compare: â˜ ï¸ vs â˜ ", expected: "Compare: <span class='emoji'>â˜ ï¸</span> vs <span class='emoji'>â˜ </span>" },
    
    // Mixed text and emoji
    { input: "Text ğŸ‰ with ğŸŒ multiple ğŸš€ emoji!", expected: "Text <span class='emoji'>ğŸ‰</span> with <span class='emoji'>ğŸŒ</span> multiple <span class='emoji'>ğŸš€</span> emoji!" },
    
    // Complex mixed case
    { input: "Summary: I visited ğŸ‡«ğŸ‡· and met a ğŸ‘¨ğŸ»â€ğŸ¦° who works as a ğŸ‘¨ğŸ»â€ğŸ³!", 
      expected: "Summary: I visited <span class='emoji'>ğŸ‡«ğŸ‡·</span> and met a <span class='emoji'>ğŸ‘¨ğŸ»â€ğŸ¦°</span> who works as a <span class='emoji'>ğŸ‘¨ğŸ»â€ğŸ³</span>!" },
	
	// Multiple variation selectors
	{ input: "Hearts: â¤ï¸ ğŸ’™ï¸ ğŸ’šï¸", expected: "Hearts: <span class='emoji'>â¤ï¸</span> <span class='emoji'>ğŸ’™ï¸</span> <span class='emoji'>ğŸ’šï¸</span>" },
    
    // Emoji with numbers
    { input: "Numbers: 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£", expected: "Numbers: <span class='emoji'>1ï¸âƒ£</span> <span class='emoji'>2ï¸âƒ£</span> <span class='emoji'>3ï¸âƒ£</span>" },
    
    // Flag edge cases
    { input: "Special flags: ğŸ³ï¸â€ğŸŒˆ ğŸ³ï¸â€âš§ï¸", expected: "Special flags: <span class='emoji'>ğŸ³ï¸â€ğŸŒˆ</span> <span class='emoji'>ğŸ³ï¸â€âš§ï¸</span>" },
    
    // Emoji with multiple ZWJ sequences
    { input: "Complex: ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦", expected: "Complex: <span class='emoji'>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§</span> <span class='emoji'>ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦</span>" },
    
    // Emoji at beginning and end of text
    { input: "ğŸ¯ Target at ends ğŸ¯", expected: "<span class='emoji'>ğŸ¯</span> Target at ends <span class='emoji'>ğŸ¯</span>" },
    
    // Adjacent emoji without spaces
    { input: "AdjacentğŸ˜ğŸ˜ğŸ¤©emoji", expected: "Adjacent<span class='emoji'>ğŸ˜</span><span class='emoji'>ğŸ˜</span><span class='emoji'>ğŸ¤©</span>emoji" },
    
    // Regional indicators that aren't flags
    { input: "Not flags: ğŸ‡¦ ğŸ‡§ ğŸ‡¨", expected: "Not flags: <span class='emoji'>ğŸ‡¦</span> <span class='emoji'>ğŸ‡§</span> <span class='emoji'>ğŸ‡¨</span>" },
    
    // Less common emoji
    { input: "Uncommon: ğŸ«  ğŸ«¥ ğŸ«°", expected: "Uncommon: <span class='emoji'>ğŸ« </span> <span class='emoji'>ğŸ«¥</span> <span class='emoji'>ğŸ«°</span>" },
    
    // Keycap sequences
    { input: "Keycaps: 1ï¸âƒ£ #ï¸âƒ£ *ï¸âƒ£", expected: "Keycaps: <span class='emoji'>1ï¸âƒ£</span> <span class='emoji'>#ï¸âƒ£</span> <span class='emoji'>*ï¸âƒ£</span>" },
    
    // Text presentation vs emoji presentation
    { input: "Text vs Emoji: â–¶ vs â–¶ï¸", expected: "Text vs Emoji: <span class='emoji'>â–¶</span> vs <span class='emoji'>â–¶ï¸</span>" },
    
    // Multiple consecutive variation selectors (edge case)
    { input: "Multiple VS: â¤ï¸ï¸", expected: "Multiple VS: <span class='emoji'>â¤ï¸ï¸</span>" },
    
    // Skin tone with variation selector
    { input: "Skin+VS: ğŸ‘ğŸ¿ï¸", expected: "Skin+VS: <span class='emoji'>ğŸ‘ğŸ¿ï¸</span>" }
  ];
  
  // Run tests and display results
  const results = testCases.map((testCase, index) => {
    const result = wrapEmojis(testCase.input);
    const passed = result === testCase.expected;
    
    return {
      test: index + 1,
      input: testCase.input,
      output: result,
      expected: testCase.expected,
      passed: passed
    };
  });
  
  // Display results in console
  console.log("=== EMOJI WRAPPING TEST RESULTS ===");
  results.forEach(r => {
    console.log(`\nTest #${r.test}: ${r.passed ? 'PASSED âœ…' : 'FAILED âŒ'}`);
    console.log(`Input: ${r.input}`);
    console.log(`Output: ${r.output}`);
    if (!r.passed) {
      console.log(`Expected: ${r.expected}`);
    }
  });
  
  // Visual test helper - append to document body for visual inspection
  const displayResults = () => {
    const container = document.createElement('div');
    container.innerHTML = `
      <style>
        .test-container { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin-bottom: 20px; border: 1px solid #eee; padding: 15px; border-radius: 5px; }
        .test-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .test-result { font-weight: bold; }
        .passed { color: green; }
        .failed { color: red; }
        .emoji { display: inline-block; font-size: 1.5em; }
        .test-row { margin: 5px 0; }
        .raw, .wrapped { padding: 10px; background: #f9f9f9; border-radius: 4px; margin-top: 5px; }
      </style>
      <div class="test-container">
        <h2>Emoji Wrapping Visual Test Results</h2>
        ${results.map(r => `
          <div class="test-case">
            <div class="test-header">
              <div>Test Case #${r.test}</div>
              <div class="test-result ${r.passed ? 'passed' : 'failed'}">${r.passed ? 'PASSED' : 'FAILED'}</div>
            </div>
            <div class="test-row">
              <div><strong>Raw Input:</strong></div>
              <div class="raw">${r.input}</div>
            </div>
            <div class="test-row">
              <div><strong>Wrapped Output:</strong></div>
              <div class="wrapped">${r.output}</div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
    document.body.appendChild(container);
  };
  
  // If running in a browser, display visual results
  if (typeof document !== 'undefined') {
    displayResults();
  }
  
  // Summary
  const passCount = results.filter(r => r.passed).length;
  console.log(`\n=== SUMMARY ===`);
  console.log(`${passCount} of ${results.length} tests passed`);
  
  return {
    results,
    allPassed: passCount === results.length
  };
}

// Run the test
const testResults = testEmojiWrapping();
</script>
</body>
</html>