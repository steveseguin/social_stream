<!DOCTYPE html>
<html>
<head>
    <title>Spotify Integration Setup - Social Stream Ninja</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            color-scheme: dark;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #0f0f0f;
            color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 32px;
            background: #1c1c1c;
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.65);
        }
        h1 {
            margin-top: 0;
            color: #1db954;
            font-size: 2rem;
        }
        h2 {
            margin-top: 2rem;
            font-size: 1.35rem;
        }
        p { margin: 0.5rem 0; }
        .step {
            background: #242424;
            border-radius: 12px;
            padding: 20px 24px 20px 64px;
            margin: 22px 0;
            position: relative;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .step-number {
            position: absolute;
            left: 20px;
            top: 24px;
            width: 32px;
            height: 32px;
            border-radius: 999px;
            background: #1db954;
            color: #0f0f0f;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 16px rgba(29,185,84,0.45);
        }
        .button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #1db954;
            color: #0f0f0f;
            border-radius: 999px;
            padding: 12px 24px;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 10px 20px rgba(29,185,84,0.35);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }
        .button:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 22px rgba(29,185,84,0.45);
        }
        ul { padding-left: 1.1rem; }
        .uri-list {
            background: #111;
            border-radius: 10px;
            padding: 16px 18px;
            margin-top: 10px;
        }
        .uri-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .uri-text {
            flex: 1;
            font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace;
            font-size: 0.95rem;
            word-break: break-all;
        }
        .copy-button {
            border: none;
            background: #333;
            color: #f5f5f5;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .copy-button:hover { background: #4a4a4a; }
        .note {
            background: rgba(29,185,84,0.1);
            border-left: 4px solid #1db954;
            padding: 14px 18px;
            border-radius: 12px;
            margin: 18px 0;
        }
        ol.checklist {
            padding-left: 1.2rem;
        }
        ol.checklist li {
            margin: 10px 0;
        }
        .auth-container {
            text-align: center;
            padding: 40px;
        }
        .loader {
            border: 3px solid #333;
            border-top: 3px solid #1db954;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 640px) {
            .step {
                padding: 18px;
            }
            .step-number {
                position: static;
                margin-bottom: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="guide-container">
        <h1>üéµ Spotify Integration Setup</h1>
        <p>Follow these four steps to connect your Spotify account to Social Stream Ninja. You only need to do this once per Spotify app.</p>

        <div class="note">
            <strong>Why do I need my own Spotify app?</strong><br />
            Spotify requires every integration to use its own credentials. This keeps your listening history private and under your control.
        </div>

        <div class="step">
            <div class="step-number">1</div>
            <h2>Create a Spotify App</h2>
            <p>Sign in to the Spotify Developer Dashboard and create a new app.</p>
            <a class="button" href="https://developer.spotify.com/dashboard" target="_blank" rel="noopener noreferrer">Open Spotify Dashboard ‚Üí</a>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <h2>Configure the App</h2>
            <p>Use these values in the Spotify form:</p>
            <ul>
                <li><strong>App name:</strong> Social Stream Ninja</li>
                <li><strong>Description:</strong> Integration for displaying Spotify "Now Playing" data</li>
                <li><strong>Website:</strong> https://socialstream.ninja</li>
            </ul>
            <p>Add <strong>all</strong> of the following Redirect URIs (these cover Electron + hosted flows):</p>
            <div class="uri-list">
                <div class="uri-item">
                    <span class="uri-text" data-uri>https://socialstream.ninja/spotify_callback.html</span>
                    <button class="copy-button" data-copy>Copy</button>
                </div>
                <div class="uri-item">
                    <span class="uri-text" data-uri>http://127.0.0.1:8888/callback</span>
                    <button class="copy-button" data-copy>Copy</button>
                </div>
            </div>
            <p class="note" style="margin-top:14px;">Tip: If you use a custom domain for hosting Social Stream Ninja, add that version of the callback URL as well.</p>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <h2>Collect Your Credentials</h2>
            <p>From the Spotify app's <em>Settings</em> tab:</p>
            <ol class="checklist">
                <li>Reveal and copy the <strong>Client ID</strong>.</li>
                <li>Reveal the <strong>Client Secret</strong> and copy it somewhere secure.</li>
                <li>Keep the Spotify dashboard open‚Äî you may need it again.</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-number">4</div>
            <h2>Paste the Details into Social Stream Ninja</h2>
            <p>Back in the Social Stream Ninja popup:</p>
            <ol class="checklist">
                <li>Open <strong>Settings ‚Üí üéµ Spotify Integration</strong>.</li>
                <li>Paste your Client ID and Client Secret into the matching fields.</li>
                <li>Click <strong>Connect to Spotify</strong> and follow the prompts.</li>
            </ol>
            <p>Once connected you unlock:</p>
            <ul>
                <li>Automatic ‚ÄúNow Playing‚Äù announcements.</li>
                <li>Chat commands such as <code>!song</code>, <code>!nowplaying</code>, and <code>!np</code>.</li>
                <li>Future Spotify queue tooling and Streamer.bot automations.</li>
            </ul>
        </div>

        <div class="note">
            <strong>Need to finish an in-progress login?</strong><br />
            If Spotify redirects you to a page that says "Processing authorization", just leave that tab open‚ÄîSocial Stream Ninja will finish automatically. If it ever gets stuck, re-run the login and paste the callback URL into the popup‚Äôs manual field.
        </div>
    </div>
    <div class="container" id="callback-container" style="display:none;">
        <div id="content"></div>
    </div>

    <script>
        document.querySelectorAll('[data-copy]').forEach((button) => {
            button.addEventListener('click', () => {
                const uri = button.parentElement.querySelector('[data-uri]').textContent.trim();
                navigator.clipboard.writeText(uri).then(() => {
                    button.textContent = 'Copied!';
                    setTimeout(() => button.textContent = 'Copy', 1600);
                }).catch(() => {
                    alert('Press Ctrl+C (Cmd+C on Mac) to copy the highlighted text.');
                    const range = document.createRange();
                    range.selectNode(button.parentElement.querySelector('[data-uri]'));
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                });
            });
        });

        (function() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('code') || params.has('error')) {
                const guide = document.getElementById('guide-container');
                if (guide) guide.style.display = 'none';
                const callbackShell = document.getElementById('callback-container');
                if (callbackShell) callbackShell.style.display = 'block';

                const script = document.createElement('script');
                script.src = 'spotify-callback.js';
                document.body.appendChild(script);
            }
        })();
    </script>
</body>
</html>
