<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State Nodes Playbook - Social Stream Ninja</title>
    <style>
        :root {
            color-scheme: light dark;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: radial-gradient(circle at top, #4338ca 0%, #0f172a 55%, #020617 100%);
            color: #0f172a;
            min-height: 100vh;
            padding: 25px;
        }
        .shell {
            max-width: 1150px;
            margin: 0 auto;
            background: #fdfdfd;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 35px 80px rgba(3, 7, 18, 0.55);
        }
        header {
            background: linear-gradient(135deg, #4c1d95, #312e81, #1d4ed8);
            color: #fff;
            padding: 60px 55px;
        }
        header h1 {
            font-size: 2.7rem;
            margin-bottom: 12px;
        }
        header p {
            font-size: 1.15rem;
            max-width: 680px;
            opacity: 0.92;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 11px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 999px;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.06em;
            margin-bottom: 18px;
        }
        nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 25px;
        }
        nav a {
            color: #f8fafc;
            text-decoration: none;
            font-size: 0.9rem;
            border: 1px solid rgba(255,255,255,0.25);
            border-radius: 999px;
            padding: 6px 16px;
            transition: background 0.2s;
        }
        nav a:hover {
            background: rgba(15,23,42,0.25);
        }
        .content {
            padding: 50px 55px 70px;
        }
        section {
            margin-bottom: 70px;
        }
        h2 {
            font-size: 2rem;
            color: #312e81;
            margin-bottom: 18px;
        }
        h3 {
            font-size: 1.35rem;
            color: #4338ca;
            margin: 20px 0 10px;
        }
        p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        ul {
            padding-left: 24px;
            margin: 12px 0;
        }
        li {
            margin: 6px 0;
        }
        .panel {
            border-radius: 16px;
            padding: 22px;
            margin: 18px 0;
        }
        .panel.info {
            background: #eef2ff;
            border: 1px solid rgba(67,56,202,0.2);
        }
        .panel.warn {
            background: #fff7ed;
            border: 1px solid rgba(234,88,12,0.25);
        }
        .panel.success {
            background: #ecfdf5;
            border: 1px solid rgba(5,150,105,0.2);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 18px;
            margin: 20px 0;
        }
        .card {
            border-radius: 18px;
            border: 1px solid rgba(15,23,42,0.08);
            box-shadow: 0 10px 30px rgba(15,23,42,0.08);
            padding: 20px 22px;
            background: #fff;
        }
        .card h4 {
            margin-bottom: 10px;
            color: #4c1d95;
        }
        .diagram {
            font-family: 'JetBrains Mono','Courier New', monospace;
            background: #0f172a;
            color: #e0e7ff;
            border-radius: 14px;
            padding: 18px;
            margin: 16px 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .recipe {
            border-left: 4px solid #312e81;
            padding-left: 18px;
            margin: 18px 0;
        }
        .recipe h4 {
            margin-bottom: 6px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }
        table th, table td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: left;
        }
        table th {
            background: #f1f5f9;
            color: #312e81;
        }
        code {
            background: rgba(15,23,42,0.06);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono','Courier New', monospace;
        }
        @media (max-width: 720px) {
            header, .content {
                padding: 35px 20px;
            }
            nav {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="shell">
        <header>
            <div class="badge">Event Flow System</div>
            <h1>State Nodes Playbook</h1>
            <p>State nodes give Social Stream Ninja memory. Use them to build cooldowns, toggles, counters, and throttles that keep automations predictable. This guide breaks the topic into focused mini-guides with examples and troubleshooting tips.</p>
            <nav>
                <a href="#overview">Overview</a>
                <a href="#switch">On/Off Switch</a>
                <a href="#counter">Counter</a>
                <a href="#throttle">Rate Limiter</a>
                <a href="#recipes">Problem Kits</a>
                <a href="#troubleshooting">Troubleshooting</a>
            </nav>
        </header>
        <div class="content">
            <section id="overview">
                <h2>01 · Quick Orientation</h2>
                <p>Every State node has two halves:</p>
                <div class="grid">
                    <div class="card">
                        <h4>State Node</h4>
                        <ul>
                            <li>Lives on the canvas.</li>
                            <li>Holds the value (ON/OFF, count, timestamps).</li>
                            <li>Runs for every message that enters the node.</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>State Action</h4>
                        <ul>
                            <li>Placed downstream.</li>
                            <li>Changes the stored value (set ON, add +1, reset, etc.).</li>
                            <li>Can live anywhere in the flow—just pick the matching node name.</li>
                        </ul>
                    </div>
                </div>
                <div class="panel info">
                    <strong>Remember:</strong> Add the State node first, give it a unique name, then wire the matching action node. Without the base node, Set/Increment/Reset actions have nothing to talk to.
                </div>
            </section>

            <section id="switch">
                <h2>02 · On/Off Switch (Gate)</h2>
                <p>The switch is a boolean guard. When ON, messages pass through; when OFF, the flow halts at this node.</p>
                <div class="grid">
                    <div class="card">
                        <h4>Best for</h4>
                        <ul>
                            <li>Cooldowns for chat commands.</li>
                            <li>Manual toggles (enable/disable overlays).</li>
                            <li>Maintenance windows (pause features during BRB scenes).</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Key Actions</h4>
                        <ul>
                            <li><code>Set Gate State</code> — flip ON or OFF.</li>
                            <li><code>Reset State Node</code> — revert to default (usually ON).</li>
                        </ul>
                    </div>
                </div>
                <h3>Example: 15s Cooldown</h3>
                <div class="diagram">
!hello ──▶ Switch (ON?) ─▶ Send Reply ─▶ Set Gate: OFF ─▶ Delay 15s ─▶ Set Gate: ON
                </div>
                <div class="recipe">
                    <h4>Build Steps</h4>
                    <ol>
                        <li>Drop the switch node, name it “helloCooldown”, default ON.</li>
                        <li>Connect your trigger → switch → actions.</li>
                        <li>After your action, add <em>Set Gate State</em> (OFF) referencing “helloCooldown”.</li>
                        <li>Add a <em>Delay</em> node (15 seconds).</li>
                        <li>Add another <em>Set Gate State</em> (ON) for “helloCooldown”.</li>
                    </ol>
                </div>
            </section>

            <section id="counter">
                <h2>03 · Counter</h2>
                <p>Counters track numbers across messages. They increment automatically when a message flows through, and you can adjust values manually with actions.</p>
                <div class="panel success">
                    <strong>Auto increment:</strong> Every time a payload passes through the Counter node it adds 1 (unless you pause it with the “Only count when gate is true” option).
                </div>
                <div class="grid">
                    <div class="card">
                        <h4>Use Cases</h4>
                        <ul>
                            <li>Every Nth chatter triggers a prize.</li>
                            <li>Track progress to a community goal.</li>
                            <li>Store points redeemed via commands.</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Actions</h4>
                        <ul>
                            <li><code>Increment Counter</code> — add or subtract custom amounts.</li>
                            <li><code>Set Counter Value</code> — jump to a specific number.</li>
                            <li><code>Reset State Node</code> — revert to the default start value.</li>
                        </ul>
                    </div>
                </div>
                <h3>Example: Celebrate Every 5 Messages</h3>
                <div class="diagram">
Any Message ─▶ Counter (name: hype5) ─▶ Condition (value % 5 === 0?) ─▶ Play Celebration
                </div>
                <p>Inside the Condition node, compare <code>state.hype5.value</code> or simply use the built-in “Trigger when value matches Target” option from the Counter node’s properties.</p>
            </section>

            <section id="throttle">
                <h2>04 · Rate Limiter (Throttle)</h2>
                <p>The throttle remembers timestamps and refuses new events until the rate you specify is respected.</p>
                <div class="grid">
                    <div class="card">
                        <h4>Great When You Need</h4>
                        <ul>
                            <li>“Only five raffle entries per minute.”</li>
                            <li>“One API call per 10 seconds.”</li>
                            <li>“Drop alerts if the overlay is already busy.”</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Configuration</h4>
                        <ul>
                            <li>Set the maximum events allowed.</li>
                            <li>Choose the time window (seconds).</li>
                            <li>Decide whether to queue or discard overflow.</li>
                        </ul>
                    </div>
                </div>
                <div class="panel warn">
                    <strong>Heads up:</strong> Throttles do not auto-reset when you edit the flow. Use <code>Reset State Node</code> if you need a clean slate during testing.
                </div>
            </section>

            <section id="recipes">
                <h2>05 · Problem Kits</h2>
                <p>Pick a scenario and follow the steps.</p>
                <div class="grid">
                    <div class="card">
                        <h4>Command Cooldown</h4>
                        <ol>
                            <li>Switch node named “commandCooldown”.</li>
                            <li>Trigger → switch → reply.</li>
                            <li>Set Gate OFF → Delay → Set Gate ON.</li>
                            <li>Add a chat message “Cooldown active” on the false output if desired.</li>
                        </ol>
                    </div>
                    <div class="card">
                        <h4>Limited Freebies</h4>
                        <ol>
                            <li>Counter default 0, target 3.</li>
                            <li>Increment after each redemption.</li>
                            <li>When value ≥ 3, branch to “Sorry, all gone”.</li>
                            <li>Use Reset action at the end of stream.</li>
                        </ol>
                    </div>
                    <div class="card">
                        <h4>Viewer Toggle</h4>
                        <ol>
                            <li>Switch named “overlayToggle”.</li>
                            <li><code>!overlay on</code> command → Set Gate ON.</li>
                            <li><code>!overlay off</code> command → Set Gate OFF.</li>
                            <li>All overlay triggers pass through the switch.</li>
                        </ol>
                    </div>
                </div>

                <h3>Example Flow Charts</h3>
                <div class="diagram">
Trigger ─▶ Switch (overlayToggle) ─▶ If ON → Show Overlay
           └─false─▶ Notify moderator “Overlay disabled”
                </div>
                <div class="diagram">
Redeem Reward ─▶ Counter ticketsSold
                      ├─value < 50 ─▶ Approve Redemption
                      └─value ≥ 50 ─▶ Deny + Refund points
                </div>
            </section>

            <section id="troubleshooting">
                <h2>06 · Troubleshooting & FAQ</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Symptom</th>
                            <th>Likely Cause</th>
                            <th>Fix</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Set Gate State action won’t save.</td>
                            <td>No matching switch node exists (or the names differ).</td>
                            <td>Add the switch node first and confirm the dropdown references it.</td>
                        </tr>
                        <tr>
                            <td>Counter never increments.</td>
                            <td>The flow bypasses the counter node or the gate is false.</td>
                            <td>Make sure the trigger wire passes through the counter and the gate output is true.</td>
                        </tr>
                        <tr>
                            <td>Throttle blocks everything forever.</td>
                            <td>Window too strict or leftover state from testing.</td>
                            <td>Relax the limit and drop a Reset State Node action before retesting.</td>
                        </tr>
                        <tr>
                            <td>Guide buttons don’t open.</td>
                            <td>Running inside the extension without web_accessible resources updated.</td>
                            <td>Ensure <code>actions/state-nodes-guide.html</code> ships via manifest and reload the extension.</td>
                        </tr>
                    </tbody>
                </table>
                <h3>Testing Checklist</h3>
                <ul>
                    <li>Use the Event Flow “Send Test Event” tool to simulate commands.</li>
                    <li>Temporarily shorten cooldowns (2 seconds) or lower counter targets while verifying.</li>
                    <li>Reset state nodes between tests so you are not reading stale data.</li>
                    <li>Label branches (e.g., “false → cooldown active”) so you can follow the path visually.</li>
                </ul>
            </section>

            <section>
                <h2>07 · Next Steps</h2>
                <p>Combine state nodes with the rest of the Event Flow toolkit:</p>
                <ul>
                    <li>Use logic gates (AND/OR/NOT) before a switch to decide who can toggle it.</li>
                    <li>Store state-driven metadata under <code>meta</code> so overlays know why a branch fired.</li>
                    <li>Export working patterns as templates so your team can re-import them later.</li>
                </ul>
                <div class="panel info">
                    Keep experimenting! The new <a href="event-flow-guide.html">Event Flow Guide</a> pairs with this playbook so you can master both logic and state layers.
                </div>
            </section>
        </div>
    </div>
</body>
</html>
